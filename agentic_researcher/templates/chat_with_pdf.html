{# agentic_researcher/templates/chat_with_pdf.html #}
{% extends "base.html" %}
{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/chat_with_pdf.css' %}">
{% endblock %}

{% block content %}
  <div class="chat-container">
    <!-- Left: Chat History -->
    <aside id="history-panel">
      <div id="history-header">
        <h3>Chat History</h3>
        <button id="toggle-history">⮜</button>
      </div>
      <ul id="chat-history">
        <!-- populated by JS -->
      </ul>
    </aside>

    <!-- Right: Chat Interface -->
    <main class="chat-main">
      <div class="chat-header">
        Chat with PDF: <strong>{{ pdf_title }}</strong>
      </div>
      <div id="chat-window">
        <!-- chat bubbles go here -->
      </div>
      <form id="chat-form">
        {% csrf_token %}
        <input
          type="text"
          id="chat-input"
          placeholder="Ask something about this PDF…"
          autocomplete="off"
        />
        <button type="submit" id="send-btn">Send</button>
      </form>
    </main>
  </div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const pdfId      = {{ pdf_id }};
  const apiUrl     = `/api/chat/pdf/${pdfId}/`;
  const historyKey = `chatHistory_${pdfId}`;

  // Load or initialize per-PDF history
  let history = JSON.parse(localStorage.getItem(historyKey) || "[]");

  // Render functions…
  // (your existing renderHistory, renderChatUpTo, toggle, etc.)

  // On each new question/answer you already push into `history`
  // and call localStorage.setItem(historyKey, …) — perfect!

  // Because the key includes pdfId, uploading a *new* PDF
  // (with a different ID) automatically gives you an empty cache.
});
</script>
{% endblock %}
